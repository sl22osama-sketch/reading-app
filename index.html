
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Noto+Sans+Arabic:wght@400;500;600;700;800&family=Cairo:wght@400;600;700;800&display=swap');
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans Arabic', 'Amiri', 'Cairo', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #f3e5f5 50%, #fce4ec 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(33, 150, 243, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(156, 39, 176, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(103, 58, 183, 0.25) 0%, transparent 50%),
                radial-gradient(circle at 60% 60%, rgba(255, 193, 7, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.15);
        }
        
        .glass-card-dark {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        }
        
        .reading-text {
            line-height: 3;
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a202c;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            letter-spacing: 0.5px;
            word-spacing: 4px;
            font-family: 'Noto Sans Arabic', 'Amiri', serif;
        }
        
        .timer-circle {
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 1s linear;
            filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.5));
        }
        
        .timer-container {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }
        
        .btn-gradient {
            background: linear-gradient(145deg, #1976d2, #7b1fa2);
            border: none;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(25, 118, 210, 0.4);
            font-weight: 600;
        }
        
        .btn-gradient:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(25, 118, 210, 0.6);
        }
        
        .btn-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .btn-gradient:hover::before {
            left: 100%;
        }
        
        .btn-success {
            background: linear-gradient(145deg, #10b981, #059669);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        
        .btn-success:hover {
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.6);
        }
        
        .btn-warning {
            background: linear-gradient(145deg, #f59e0b, #d97706);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }
        
        .btn-warning:hover {
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.6);
        }
        
        .btn-danger {
            background: linear-gradient(145deg, #ef4444, #dc2626);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }
        
        .btn-danger:hover {
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.6);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s ease;
            box-shadow: 0 2px 10px rgba(16, 185, 129, 0.3);
        }
        
        .stats-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        
        .word-highlight {
            background: linear-gradient(120deg, #fef3c7, #fde68a);
            padding: 4px 8px;
            border-radius: 8px;
            border: 2px solid #f59e0b;
            font-weight: 700;
            font-size: 1.1em;
            animation: pulse 2s infinite;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .celebration {
            animation: celebrate 0.6s ease-in-out;
        }
        
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .floating-icon {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .recording-pulse {
            animation: recordingPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes recordingPulse {
            0%, 100% { 
                background: linear-gradient(145deg, #ef4444, #dc2626);
                box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
            }
            50% { 
                background: linear-gradient(145deg, #f87171, #ef4444);
                box-shadow: 0 8px 25px rgba(239, 68, 68, 0.8);
            }
        }
        
        .recording-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            animation: blink 1s infinite;
            margin-left: 8px;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
    </style>
</head>
<body class="p-4">
    <!-- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
                ğŸ“š Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ
            </h1>
            <p class="text-lg text-gray-600 font-medium">
                Ø·ÙˆØ± Ù…Ù‡Ø§Ø±Ø§ØªÙƒ ÙÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¹ Ø§Ù„ØªÙˆÙ‚ÙŠØª ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙØµÙ„Ø©
            </p>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Reading Area -->
            <div class="lg:col-span-2">
                <div class="glass-card rounded-2xl p-6 mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                            <span class="floating-icon">ğŸ“–</span>
                            <span class="mr-3">Ù†Øµ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</span>
                        </h2>
                        <div class="flex gap-2">
                            <button onclick="changeTextSize('increase')" class="btn-gradient text-white px-4 py-2 rounded-lg text-sm">
                                Ø£+
                            </button>
                            <button onclick="changeTextSize('decrease')" class="btn-gradient text-white px-4 py-2 rounded-lg text-sm">
                                Ø£-
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <select id="textSelect" onchange="loadSelectedText()" class="w-full p-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none font-medium">
                            <option value="0">Ø§Ù„Ù†Øµ Ø§Ù„Ø£ÙˆÙ„ - Ø§Ù„ØªÙÙ‘ÙƒÙ’Ù†ÙÙˆÙ„ÙÙˆØ¬ÙÙŠÙØ§ ÙÙÙŠ Ø­ÙÙŠÙØ§ØªÙÙ†ÙØ§</option>
                            <option value="1">Ø§Ù„Ù†Øµ Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø­ÙÙ…ÙØ§ÙŠÙØ©Ù Ø§Ù„Ù’Ø¨ÙÙŠØ¦ÙØ©Ù Ù…ÙØ³Ù’Ø¤ÙÙˆÙ„ÙÙŠÙÙ‘ØªÙÙ†ÙØ§</option>
                            <option value="2">Ø§Ù„Ù†Øµ Ø§Ù„Ø«Ø§Ù„Ø« - Ø£ÙÙ‡ÙÙ…ÙÙ‘ÙŠÙÙ‘Ø©Ù Ø§Ù„Ù’Ù‚ÙØ±ÙØ§Ø¡ÙØ©Ù ÙˆÙØ§Ù„Ù’Ù…ÙØ·ÙØ§Ù„ÙØ¹ÙØ©Ù</option>
                        </select>
                    </div>
                    
                    <div id="readingText" class="reading-text p-8 bg-gradient-to-br from-white to-blue-50 rounded-xl border-2 border-blue-200 min-h-[350px] shadow-inner">
                        <!-- Ø§Ù„Ù†Øµ Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ù‡Ù†Ø§ -->
                    </div>
                </div>

                <!-- Controls -->
                <div class="glass-card rounded-2xl p-6">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
                            <span class="floating-icon">ğŸ®</span>
                            <span class="mr-2">Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ…</span>
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button id="startBtn" onclick="startReading()" class="btn-success text-white px-6 py-3 rounded-xl font-bold text-lg">
                                ğŸ¯ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
                            </button>
                            <button id="pauseBtn" onclick="pauseReading()" class="btn-warning text-white px-6 py-3 rounded-xl font-bold text-lg" disabled>
                                â¸ï¸ ØªÙˆÙ‚Ù
                            </button>
                            <button id="stopBtn" onclick="stopReading()" class="btn-danger text-white px-6 py-3 rounded-xl font-bold text-lg" disabled>
                                â¹ï¸ Ø¥Ù†Ù‡Ø§Ø¡
                            </button>
                            <button onclick="resetAll()" class="btn-gradient text-white px-6 py-3 rounded-xl font-bold text-lg">
                                ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                            </button>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-4">
                        <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
                            <span class="floating-icon">ğŸ¤–</span>
                            <span class="mr-2">Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¢Ù„ÙŠØ©</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <button id="autoReadBtn" onclick="toggleAutoRead()" class="btn-success text-white px-6 py-3 rounded-xl font-bold text-lg">
                                ğŸ”Š ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¢Ù„ÙŠØ©
                            </button>
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-700">Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©:</label>
                                <select id="readingSpeedSelect" onchange="updateReadingSpeed()" class="p-2 rounded-lg border border-gray-300 text-sm">
                                    <option value="0.5">Ø¨Ø·ÙŠØ¡ Ø¬Ø¯Ø§Ù‹</option>
                                    <option value="0.7">Ø¨Ø·ÙŠØ¡</option>
                                    <option value="1" selected>Ø¹Ø§Ø¯ÙŠ</option>
                                    <option value="1.3">Ø³Ø±ÙŠØ¹</option>
                                    <option value="1.5">Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-700">Ø§Ù„ØµÙˆØª:</label>
                                <select id="voiceSelect" onchange="updateSelectedVoice()" class="p-2 rounded-lg border border-gray-300 text-sm flex-1">
                                    <option value="">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª...</option>
                                </select>
                            </div>
                            <button onclick="testVoice()" class="btn-gradient text-white px-4 py-2 rounded-lg text-sm">
                                ğŸµ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-700">Ø³Ø±Ø¹Ø© Ø§Ù„Ù…Ø¤Ø´Ø±:</label>
                                <input type="range" id="cursorSpeedRange" min="0.5" max="3" step="0.1" value="1" onchange="updateCursorSpeed()" class="flex-1">
                                <span id="cursorSpeedValue" class="text-sm font-bold text-blue-600">1.0x</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <input type="checkbox" id="syncWithAudio" checked onchange="toggleSyncWithAudio()" class="rounded">
                                <label for="syncWithAudio" class="text-sm font-medium text-gray-700">Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„ØµÙˆØª</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-4">
                        <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
                            <span class="floating-icon">ğŸ™ï¸</span>
                            <span class="mr-2">Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button id="recordBtn" onclick="startRecording()" class="btn-gradient text-white px-6 py-3 rounded-xl font-bold text-lg">
                                ğŸ”´ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                            </button>
                            <button id="stopRecordBtn" onclick="stopRecording()" class="btn-danger text-white px-6 py-3 rounded-xl font-bold text-lg" disabled>
                                â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                            </button>
                            <div id="recordingStatus" class="flex items-center justify-center text-gray-600 font-medium">
                                Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ³Ø¬ÙŠÙ„
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats and Timer Sidebar -->
            <div class="space-y-6">
                <!-- Timer -->
                <div class="timer-container rounded-2xl p-6 text-center">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center justify-center">
                        <span class="floating-icon">â±ï¸</span>
                        <span class="mr-2">Ø§Ù„Ù…Ø¤Ù‚Øª</span>
                    </h3>
                    <div class="relative w-32 h-32 mx-auto mb-4">
                        <svg class="w-32 h-32 transform -rotate-90">
                            <circle cx="64" cy="64" r="45" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                            <circle id="timerCircle" cx="64" cy="64" r="45" stroke="#3b82f6" stroke-width="8" fill="none" class="timer-circle"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span id="timerDisplay" class="text-2xl font-bold text-gray-800">00:00</span>
                        </div>
                    </div>
                </div>

                <!-- Live Stats -->
                <div class="stats-card rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="floating-icon">ğŸ“Š</span>
                        <span class="mr-2">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</span>
                    </h3>
                    <div class="space-y-4">
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-xl">
                            <div class="text-sm text-gray-600 mb-1">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©</div>
                            <div id="wordsRead" class="text-2xl font-bold text-blue-600">0</div>
                        </div>
                        <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-xl">
                            <div class="text-sm text-gray-600 mb-1">Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>
                            <div id="readingSpeed" class="text-2xl font-bold text-green-600">0 Ùƒ/Ø¯</div>
                        </div>
                        <div class="bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-xl">
                            <div class="text-sm text-gray-600 mb-1">Ø§Ù„ØªÙ‚Ø¯Ù…</div>
                            <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                                <div id="progressBar" class="progress-bar h-3 rounded-full" style="width: 0%"></div>
                            </div>
                            <div id="progressText" class="text-sm font-bold text-purple-600">0%</div>
                        </div>
                    </div>
                </div>

                <!-- Session History -->
                <div class="stats-card rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="floating-icon">ğŸ“ˆ</span>
                        <span class="mr-2">Ø³Ø¬Ù„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª</span>
                    </h3>
                    <div id="sessionHistory" class="space-y-3 max-h-60 overflow-y-auto">
                        <div class="text-center text-gray-500 py-4">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯
                        </div>
                    </div>
                </div>

                <!-- Speed Chart -->
                <div class="stats-card rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="floating-icon">ğŸš€</span>
                        <span class="mr-2">Ù…Ø®Ø·Ø· Ø§Ù„Ø³Ø±Ø¹Ø©</span>
                    </h3>
                    <div class="bg-white rounded-xl p-4">
                        <canvas id="speedChart" width="300" height="200"></canvas>
                    </div>
                    <div class="mt-3 text-center">
                        <button onclick="clearSpeedChartData()" class="btn-gradient text-white px-4 py-2 rounded-lg text-sm">
                            ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø±Ø¹Ø©
                        </button>
                    </div>
                </div>

                <!-- Progress Chart -->
                <div class="stats-card rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="floating-icon">ğŸ“Š</span>
                        <span class="mr-2">Ù…Ø®Ø·Ø· Ø§Ù„ØªÙ‚Ø¯Ù…</span>
                    </h3>
                    <div class="bg-white rounded-xl p-4">
                        <canvas id="progressChart" width="300" height="200"></canvas>
                    </div>
                    <div class="mt-3 text-center">
                        <button onclick="clearProgressChartData()" class="btn-gradient text-white px-4 py-2 rounded-lg text-sm">
                            ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø¯Ù…
                        </button>
                    </div>
                </div>

                <!-- Audio Recordings -->
                <div class="stats-card rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="floating-icon">ğŸµ</span>
                        <span class="mr-2">Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©</span>
                    </h3>
                    <div id="audioRecordings" class="space-y-3 max-h-60 overflow-y-auto">
                        <div class="text-center text-gray-500 py-4">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª ØµÙˆØªÙŠØ© Ø¨Ø¹Ø¯
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…ØªØ§Ø­Ø©
        const texts = [
            {
                title: "Ø§Ù„ØªÙÙ‘ÙƒÙ’Ù†ÙÙˆÙ„ÙÙˆØ¬ÙÙŠÙØ§ ÙÙÙŠ Ø­ÙÙŠÙØ§ØªÙÙ†ÙØ§",
                content: "ØªÙØ¹Ù’ØªÙØ¨ÙØ±Ù Ø§Ù„ØªÙÙ‘ÙƒÙ’Ù†ÙÙˆÙ„ÙÙˆØ¬ÙÙŠÙØ§ Ø¬ÙØ²Ù’Ø¡Ù‹Ø§ Ù„ÙØ§ ÙŠÙØªÙØ¬ÙØ²ÙÙ‘Ø£Ù Ù…ÙÙ†Ù’ Ø­ÙÙŠÙØ§ØªÙÙ†ÙØ§ Ø§Ù„Ù’ÙŠÙÙˆÙ’Ù…ÙÙŠÙÙ‘Ø©Ù. ÙÙÙ…ÙÙ†Ù’ Ø®ÙÙ„ÙØ§Ù„Ù Ø§Ù„Ù’Ù‡ÙÙˆÙØ§ØªÙÙÙ Ø§Ù„Ø°ÙÙ‘ÙƒÙÙŠÙÙ‘Ø©Ù ÙˆÙØ§Ù„Ù’Ø­ÙØ§Ø³ÙÙˆØ¨ÙØŒ Ù†ÙØ³Ù’ØªÙØ·ÙÙŠØ¹Ù Ø§Ù„ØªÙÙ‘ÙˆÙØ§ØµÙÙ„Ù Ù…ÙØ¹Ù Ø§Ù„Ù’Ø£ÙØµÙ’Ø¯ÙÙ‚ÙØ§Ø¡Ù ÙˆÙØ§Ù„Ù’Ø¹ÙØ§Ø¦ÙÙ„ÙØ©Ù ÙÙÙŠ Ø¬ÙÙ…ÙÙŠØ¹Ù Ø£ÙÙ†Ù’Ø­ÙØ§Ø¡Ù Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…Ù. ÙƒÙÙ…ÙØ§ ØªÙØ³ÙØ§Ø¹ÙØ¯ÙÙ†ÙØ§ Ø§Ù„ØªÙÙ‘ÙƒÙ’Ù†ÙÙˆÙ„ÙÙˆØ¬ÙÙŠÙØ§ ÙÙÙŠ Ø§Ù„ØªÙÙ‘Ø¹ÙÙ„ÙÙ‘Ù…Ù Ù…ÙÙ†Ù’ Ø®ÙÙ„ÙØ§Ù„Ù Ø§Ù„Ù’Ù…ÙÙ†ÙØµÙÙ‘Ø§ØªÙ Ø§Ù„ØªÙÙ‘Ø¹Ù’Ù„ÙÙŠÙ…ÙÙŠÙÙ‘Ø©Ù ÙˆÙØ§Ù„Ù’Ù…ÙÙƒÙ’ØªÙØ¨ÙØ§ØªÙ Ø§Ù„Ø±ÙÙ‘Ù‚Ù’Ù…ÙÙŠÙÙ‘Ø©Ù. ÙˆÙÙÙÙŠ Ø§Ù„Ù’Ù…ÙØ¬ÙØ§Ù„Ù Ø§Ù„Ø·ÙÙ‘Ø¨ÙÙ‘ÙŠÙÙ‘ØŒ ØªÙÙ…ÙÙƒÙÙ‘Ù†Ù Ø§Ù„Ù’Ø£ÙØ·ÙØ¨ÙÙ‘Ø§Ø¡Ù Ù…ÙÙ†Ù’ ØªÙØ´Ù’Ø®ÙÙŠØµÙ Ø§Ù„Ù’Ø£ÙÙ…Ù’Ø±ÙØ§Ø¶Ù Ø¨ÙØ¯ÙÙ‚ÙÙ‘Ø©Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù ÙˆÙØ¹ÙÙ„ÙØ§Ø¬ÙÙ‡ÙØ§ Ø¨ÙØ·ÙØ±ÙÙ‚Ù Ø­ÙØ¯ÙÙŠØ«ÙØ©Ù. Ù„ÙÙƒÙÙ†Ù’ ÙŠÙØ¬ÙØ¨Ù Ø¹ÙÙ„ÙÙŠÙ’Ù†ÙØ§ Ø§Ø³Ù’ØªÙØ®Ù’Ø¯ÙØ§Ù…Ù Ø§Ù„ØªÙÙ‘ÙƒÙ’Ù†ÙÙˆÙ„ÙÙˆØ¬ÙÙŠÙØ§ Ø¨ÙØ­ÙÙƒÙ’Ù…ÙØ©Ù ÙˆÙØ¹ÙØ¯ÙÙ…Ù Ø§Ù„Ù’Ø¥ÙÙÙ’Ø±ÙØ§Ø·Ù ÙÙÙŠÙ‡ÙØ§ØŒ Ø­ÙØªÙÙ‘Ù‰ Ù„ÙØ§ ØªÙØ¤ÙØ«ÙÙ‘Ø±Ù Ø³ÙÙ„Ù’Ø¨Ù‹Ø§ Ø¹ÙÙ„ÙÙ‰ ØµÙØ­ÙÙ‘ØªÙÙ†ÙØ§ ÙˆÙØ¹ÙÙ„ÙØ§Ù‚ÙØ§ØªÙÙ†ÙØ§ Ø§Ù„ÙØ§Ø¬Ù’ØªÙÙ…ÙØ§Ø¹ÙÙŠÙÙ‘Ø©Ù."
            },
            {
                title: "Ø­ÙÙ…ÙØ§ÙŠÙØ©Ù Ø§Ù„Ù’Ø¨ÙÙŠØ¦ÙØ©Ù Ù…ÙØ³Ù’Ø¤ÙÙˆÙ„ÙÙŠÙÙ‘ØªÙÙ†ÙØ§",
                content: "ØªÙÙˆÙØ§Ø¬ÙÙ‡Ù Ø¨ÙÙŠØ¦ÙØªÙÙ†ÙØ§ ØªÙØ­ÙØ¯ÙÙ‘ÙŠÙØ§ØªÙ ÙƒÙØ¨ÙÙŠØ±ÙØ©Ù‹ ÙÙÙŠ Ø§Ù„Ù’Ø¹ÙØµÙ’Ø±Ù Ø§Ù„Ù’Ø­ÙØ¯ÙÙŠØ«ÙØŒ Ù…ÙÙ†Ù’Ù‡ÙØ§ Ø§Ù„ØªÙÙ‘Ù„ÙÙˆÙÙ‘Ø«Ù ÙˆÙØ§Ù„ÙØ§Ø­Ù’ØªÙØ¨ÙØ§Ø³Ù Ø§Ù„Ù’Ø­ÙØ±ÙØ§Ø±ÙÙŠÙÙ‘ ÙˆÙØªÙØ¯Ù’Ù…ÙÙŠØ±Ù Ø§Ù„Ù’ØºÙØ§Ø¨ÙØ§ØªÙ. Ù„ÙØ°ÙÙ„ÙÙƒÙØŒ ÙŠÙØ¬ÙØ¨Ù Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„ÙÙ‘ ÙÙØ±Ù’Ø¯Ù Ù…ÙÙ†ÙÙ‘Ø§ Ø£ÙÙ†Ù’ ÙŠÙØªÙØ­ÙÙ…ÙÙ‘Ù„Ù Ù…ÙØ³Ù’Ø¤ÙÙˆÙ„ÙÙŠÙÙ‘ØªÙÙ‡Ù ÙÙÙŠ Ø­ÙÙ…ÙØ§ÙŠÙØ©Ù Ø§Ù„Ù’Ø¨ÙÙŠØ¦ÙØ©Ù. ÙŠÙÙ…Ù’ÙƒÙÙ†ÙÙ†ÙØ§ Ø§Ù„Ù’Ø¨ÙØ¯Ù’Ø¡Ù Ø¨ÙØ®ÙØ·ÙÙˆÙØ§ØªÙ Ø¨ÙØ³ÙÙŠØ·ÙØ©Ù Ù…ÙØ«Ù’Ù„Ù ØªÙÙˆÙ’ÙÙÙŠØ±Ù Ø§Ù„Ù’Ù…ÙØ§Ø¡Ù ÙˆÙØ§Ù„Ù’ÙƒÙÙ‡Ù’Ø±ÙØ¨ÙØ§Ø¡ÙØŒ ÙˆÙØ¥ÙØ¹ÙØ§Ø¯ÙØ©Ù ØªÙØ¯Ù’ÙˆÙÙŠØ±Ù Ø§Ù„Ù’Ù…ÙÙˆÙØ§Ø¯ÙÙ‘ØŒ ÙˆÙØ§Ø³Ù’ØªÙØ®Ù’Ø¯ÙØ§Ù…Ù ÙˆÙØ³ÙØ§Ø¦ÙÙ„Ù Ø§Ù„Ù†ÙÙ‘Ù‚Ù’Ù„Ù Ø§Ù„ØµÙÙ‘Ø¯ÙÙŠÙ‚ÙØ©Ù Ù„ÙÙ„Ù’Ø¨ÙÙŠØ¦ÙØ©Ù. ÙƒÙÙ…ÙØ§ ÙŠÙÙ…Ù’ÙƒÙÙ†ÙÙ†ÙØ§ Ø²ÙØ±ÙØ§Ø¹ÙØ©Ù Ø§Ù„Ù’Ø£ÙØ´Ù’Ø¬ÙØ§Ø±Ù ÙˆÙØ§Ù„Ù†ÙÙ‘Ø¨ÙØ§ØªÙØ§ØªÙ ÙÙÙŠ Ø­ÙØ¯ÙØ§Ø¦ÙÙ‚ÙÙ†ÙØ§ ÙˆÙÙ…ÙØ¯ÙØ§Ø±ÙØ³ÙÙ†ÙØ§. Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ø¹ÙÙ…ÙÙ„Ù Ø§Ù„Ù’Ø¬ÙÙ…ÙØ§Ø¹ÙÙŠÙÙ‘ ÙˆÙØ§Ù„ØªÙÙ‘Ø¹ÙØ§ÙˆÙÙ†Ù Ø¨ÙÙŠÙ’Ù†Ù Ø§Ù„Ù’Ø£ÙÙÙ’Ø±ÙØ§Ø¯Ù ÙˆÙØ§Ù„Ù’Ù…ÙØ¤ÙØ³ÙÙ‘Ø³ÙØ§ØªÙ Ø¶ÙØ±ÙÙˆØ±ÙÙŠÙŒÙ‘ Ù„ÙØ¶ÙÙ…ÙØ§Ù†Ù Ù…ÙØ³Ù’ØªÙÙ‚Ù’Ø¨ÙÙ„Ù Ø£ÙÙÙ’Ø¶ÙÙ„Ù Ù„ÙÙ„Ù’Ø£ÙØ¬Ù’ÙŠÙØ§Ù„Ù Ø§Ù„Ù’Ù‚ÙØ§Ø¯ÙÙ…ÙØ©Ù."
            },
            {
                title: "Ø£ÙÙ‡ÙÙ…ÙÙ‘ÙŠÙÙ‘Ø©Ù Ø§Ù„Ù’Ù‚ÙØ±ÙØ§Ø¡ÙØ©Ù ÙˆÙØ§Ù„Ù’Ù…ÙØ·ÙØ§Ù„ÙØ¹ÙØ©Ù",
                content: "ØªÙØ¹ÙØ¯ÙÙ‘ Ø§Ù„Ù’Ù‚ÙØ±ÙØ§Ø¡ÙØ©Ù Ù…ÙÙ†Ù’ Ø£ÙÙ‡ÙÙ…ÙÙ‘ Ø§Ù„Ù’Ù…ÙÙ‡ÙØ§Ø±ÙØ§ØªÙ Ø§Ù„ÙÙ‘ØªÙÙŠ ÙŠÙØ¬ÙØ¨Ù Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ù’Ø¥ÙÙ†Ù’Ø³ÙØ§Ù†Ù Ø¥ÙØªÙ’Ù‚ÙØ§Ù†ÙÙ‡ÙØ§ ÙˆÙØªÙØ·Ù’ÙˆÙÙŠØ±ÙÙ‡ÙØ§. ÙÙÙ‡ÙÙŠÙ ØªÙÙÙ’ØªÙØ­Ù Ø£ÙÙ…ÙØ§Ù…ÙÙ†ÙØ§ Ø¢ÙÙØ§Ù‚Ù‹Ø§ ÙˆÙØ§Ø³ÙØ¹ÙØ©Ù‹ Ù…ÙÙ†Ù Ø§Ù„Ù’Ù…ÙØ¹Ù’Ø±ÙÙÙØ©Ù ÙˆÙØ§Ù„Ø«ÙÙ‘Ù‚ÙØ§ÙÙØ©ÙØŒ ÙˆÙØªÙÙ†ÙÙ…ÙÙ‘ÙŠ Ù‚ÙØ¯Ù’Ø±ÙØ§ØªÙÙ†ÙØ§ Ø§Ù„Ù’Ø¹ÙÙ‚Ù’Ù„ÙÙŠÙÙ‘Ø©Ù ÙˆÙØ§Ù„Ù’Ø¥ÙØ¨Ù’Ø¯ÙØ§Ø¹ÙÙŠÙÙ‘Ø©Ù. Ø¹ÙÙ†Ù’Ø¯ÙÙ…ÙØ§ Ù†ÙÙ‚Ù’Ø±ÙØ£ÙØŒ Ù†ÙÙƒÙ’ØªÙØ³ÙØ¨Ù Ù…ÙÙÙ’Ø±ÙØ¯ÙØ§ØªÙ Ø¬ÙØ¯ÙÙŠØ¯ÙØ©Ù‹ ÙˆÙÙ†ÙØ­ÙØ³ÙÙ‘Ù†Ù Ù…ÙÙ†Ù’ Ø£ÙØ³Ù’Ù„ÙÙˆØ¨ÙÙ†ÙØ§ ÙÙÙŠ Ø§Ù„ØªÙÙ‘Ø¹Ù’Ø¨ÙÙŠØ±Ù ÙˆÙØ§Ù„Ù’ÙƒÙØªÙØ§Ø¨ÙØ©Ù. ÙƒÙÙ…ÙØ§ Ø£ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ù‚ÙØ±ÙØ§Ø¡ÙØ©Ù ØªÙØ³ÙØ§Ø¹ÙØ¯ÙÙ†ÙØ§ Ø¹ÙÙ„ÙÙ‰ ÙÙÙ‡Ù’Ù…Ù Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…Ù Ù…ÙÙ†Ù’ Ø­ÙÙˆÙ’Ù„ÙÙ†ÙØ§ ÙˆÙØªÙÙˆÙØ³ÙÙ‘Ø¹Ù Ù…ÙØ¯ÙØ§Ø±ÙÙƒÙÙ†ÙØ§. ÙˆÙÙ…ÙÙ†Ù’ ÙÙÙˆÙØ§Ø¦ÙØ¯ÙÙ‡ÙØ§ Ø£ÙÙŠÙ’Ø¶Ù‹Ø§ Ø£ÙÙ†ÙÙ‘Ù‡ÙØ§ ØªÙÙ‚ÙÙ„ÙÙ‘Ù„Ù Ù…ÙÙ†Ù Ø§Ù„ØªÙÙ‘ÙˆÙØªÙÙ‘Ø±Ù ÙˆÙØªÙØ­ÙØ³ÙÙ‘Ù†Ù Ù…ÙÙ†Ù Ø§Ù„ØªÙÙ‘Ø±Ù’ÙƒÙÙŠØ²Ù ÙˆÙØ§Ù„Ø°ÙÙ‘Ø§ÙƒÙØ±ÙØ©Ù. Ù„ÙØ°ÙÙ„ÙÙƒÙØŒ ÙŠÙÙ†Ù’Ø¨ÙØºÙÙŠ Ø£ÙÙ†Ù’ Ù†ÙØ¬Ù’Ø¹ÙÙ„Ù Ø§Ù„Ù’Ù‚ÙØ±ÙØ§Ø¡ÙØ©Ù Ø¹ÙØ§Ø¯ÙØ©Ù‹ ÙŠÙÙˆÙ’Ù…ÙÙŠÙÙ‘Ø©Ù‹ ÙÙÙŠ Ø­ÙÙŠÙØ§ØªÙÙ†ÙØ§ØŒ ÙˆÙØ£ÙÙ†Ù’ Ù†ÙØ®Ù’ØªÙØ§Ø±Ù Ø§Ù„Ù’ÙƒÙØªÙØ¨Ù Ø§Ù„ÙÙ‘ØªÙÙŠ ØªÙÙ†ÙØ§Ø³ÙØ¨Ù Ø§Ù‡Ù’ØªÙÙ…ÙØ§Ù…ÙØ§ØªÙÙ†ÙØ§ ÙˆÙØªÙØ«Ù’Ø±ÙÙŠ Ù…ÙØ¹Ù’Ù„ÙÙˆÙ…ÙØ§ØªÙÙ†ÙØ§."
            }
        ];

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let isReading = false;
        let isPaused = false;
        let startTime = null;
        let pausedTime = 0;
        let currentWordIndex = 0;
        let words = [];
        let timerInterval = null;
        let currentTextIndex = 0;
        let fontSize = 24;
        let sessions = [];
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¢Ù„ÙŠØ©
        let isAutoReading = false;
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;
        let autoReadSpeed = 1;
        let cursorSpeed = 1;
        let syncWithAudio = true;
        let autoReadInterval = null;
        let selectedVoice = null;
        let availableVoices = [];
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let audioStream = null;
        let recordingStartTime = null;
        let recordingTimer = null;
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
        let speedChart = null;
        let progressChart = null;
        let speedChartData = {
            labels: [],
            datasets: [{
                label: 'Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© (ÙƒÙ„Ù…Ø©/Ø¯Ù‚ÙŠÙ‚Ø©)',
                data: [],
                borderColor: 'rgb(59, 130, 246)',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                tension: 0.4,
                fill: true
            }]
        };
        let progressChartData = {
            labels: [],
            datasets: [{
                label: 'Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ‚Ø¯Ù… (%)',
                data: [],
                borderColor: 'rgb(16, 185, 129)',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.4,
                fill: true
            }]
        };

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø­Ø¯Ø¯
        function loadSelectedText() {
            currentTextIndex = parseInt(document.getElementById('textSelect').value);
            const text = texts[currentTextIndex];
            words = text.content.split(' ');
            
            const readingTextDiv = document.getElementById('readingText');
            readingTextDiv.innerHTML = words.map((word, index) => 
                `<span id="word-${index}" class="cursor-pointer hover:bg-yellow-100 transition-colors duration-300 px-2 py-1 rounded-lg font-medium">${word}</span>`
            ).join(' ');
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ
            readingTextDiv.style.fontSize = fontSize + 'px';
            
            resetReading();
        }

        // ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
        function changeTextSize(action) {
            if (action === 'increase' && fontSize < 36) {
                fontSize += 3;
            } else if (action === 'decrease' && fontSize > 18) {
                fontSize -= 3;
            }
            
            const readingTextElement = document.getElementById('readingText');
            readingTextElement.style.fontSize = fontSize + 'px';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø­Ø³Ø¨ Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
            if (fontSize >= 30) {
                readingTextElement.style.lineHeight = '3.5';
                readingTextElement.style.wordSpacing = '6px';
            } else if (fontSize >= 24) {
                readingTextElement.style.lineHeight = '3.2';
                readingTextElement.style.wordSpacing = '5px';
            } else {
                readingTextElement.style.lineHeight = '3';
                readingTextElement.style.wordSpacing = '4px';
            }
        }

        // ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¢Ù„ÙŠØ©
        function toggleAutoRead() {
            if (isAutoReading) {
                stopAutoRead();
            } else {
                startAutoRead();
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¢Ù„ÙŠØ©
        function startAutoRead() {
            if (words.length === 0) return;
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙˆÙ‚Ù Ø£ÙŠ Ù†Ø·Ù‚ Ø³Ø§Ø¨Ù‚
            speechSynthesis.cancel();
            
            isAutoReading = true;
            const text = words.join(' ');
            
            // Ø§Ù†ØªØ¸Ø§Ø± Ù‚ØµÙŠØ± Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„Ø³Ø§Ø¨Ù‚
            setTimeout(() => {
                // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ù†Ø·Ù‚
                currentUtterance = new SpeechSynthesisUtterance(text);
                
                // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø³Ù†Ø©
                currentUtterance.lang = 'ar-SA'; // Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©
                currentUtterance.rate = autoReadSpeed;
                currentUtterance.pitch = 1.0;
                currentUtterance.volume = 1.0;
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø£Ùˆ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµÙˆØª Ø¹Ø±Ø¨ÙŠ
                if (selectedVoice) {
                    currentUtterance.voice = selectedVoice;
                    console.log('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø¯Ø¯:', selectedVoice.name);
                } else {
                    const voices = speechSynthesis.getVoices();
                    const arabicVoice = voices.find(voice => 
                        voice.lang.includes('ar') || 
                        voice.name.includes('Arabic') ||
                        voice.name.includes('Ø¹Ø±Ø¨ÙŠ')
                    );
                    
                    if (arabicVoice) {
                        currentUtterance.voice = arabicVoice;
                        console.log('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØª Ø§Ù„Ø¹Ø±Ø¨ÙŠ:', arabicVoice.name);
                    } else {
                        console.log('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙˆØª Ø¹Ø±Ø¨ÙŠØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ');
                    }
                }
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                document.getElementById('autoReadBtn').innerHTML = 'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¢Ù„ÙŠØ©';
                document.getElementById('autoReadBtn').classList.remove('btn-success');
                document.getElementById('autoReadBtn').classList.add('btn-warning');
                
                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                currentUtterance.onstart = () => {
                    console.log('Ø¨Ø¯Ø£ Ø§Ù„Ù†Ø·Ù‚');
                    showNotification('ğŸ”Š Ø¨Ø¯Ø£Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¢Ù„ÙŠØ©', 'success', 2000);
                };
                
                currentUtterance.onend = () => {
                    console.log('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ù†Ø·Ù‚');
                    stopAutoRead();
                };
                
                currentUtterance.onerror = (event) => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø·Ù‚:', event.error);
                    showNotification('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª: ' + event.error, 'error', 3000);
                    stopAutoRead();
                };
                
                currentUtterance.onpause = () => {
                    console.log('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø·Ù‚ Ù…Ø¤Ù‚ØªØ§Ù‹');
                };
                
                currentUtterance.onresume = () => {
                    console.log('ØªÙ… Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù†Ø·Ù‚');
                };
                
                // Ø¨Ø¯Ø¡ ØªØªØ¨Ø¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù…Ø¹ Ø§Ù„ØµÙˆØª
                if (syncWithAudio) {
                    startWordTracking();
                }
                
                // Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø·Ù‚
                try {
                    speechSynthesis.speak(currentUtterance);
                    console.log('ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø·Ù‚ Ø¨Ù†Ø¬Ø§Ø­');
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø·Ù‚:', error);
                    showNotification('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª', 'error');
                    stopAutoRead();
                }
            }, 100);
        }

        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¢Ù„ÙŠØ©
        function stopAutoRead() {
            isAutoReading = false;
            
            if (currentUtterance) {
                speechSynthesis.cancel();
                currentUtterance = null;
            }
            
            if (autoReadInterval) {
                clearInterval(autoReadInterval);
                autoReadInterval = null;
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            document.getElementById('autoReadBtn').innerHTML = 'ğŸ”Š ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¢Ù„ÙŠØ©';
            document.getElementById('autoReadBtn').classList.remove('btn-warning');
            document.getElementById('autoReadBtn').classList.add('btn-success');
        }

        // ØªØ­Ø¯ÙŠØ« Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¢Ù„ÙŠØ©
        function updateReadingSpeed() {
            autoReadSpeed = parseFloat(document.getElementById('readingSpeedSelect').value);
            
            if (isAutoReading && currentUtterance) {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø¨Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                stopAutoRead();
                setTimeout(() => startAutoRead(), 100);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø³Ø±Ø¹Ø© Ø§Ù„Ù…Ø¤Ø´Ø±
        function updateCursorSpeed() {
            cursorSpeed = parseFloat(document.getElementById('cursorSpeedRange').value);
            document.getElementById('cursorSpeedValue').textContent = cursorSpeed.toFixed(1) + 'x';
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„ØµÙˆØª
        function toggleSyncWithAudio() {
            syncWithAudio = document.getElementById('syncWithAudio').checked;
        }

        // ØªØªØ¨Ø¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù…Ø¹ Ø§Ù„ØµÙˆØª
        function startWordTracking() {
            if (!syncWithAudio) return;
            
            const wordsPerSecond = (autoReadSpeed * 2.5) * cursorSpeed; // ØªÙ‚Ø¯ÙŠØ± ØªÙ‚Ø±ÙŠØ¨ÙŠ
            const intervalTime = 1000 / wordsPerSecond;
            
            autoReadInterval = setInterval(() => {
                if (currentWordIndex < words.length - 1 && isAutoReading) {
                    currentWordIndex++;
                    highlightCurrentWord();
                    updateProgress();
                } else {
                    clearInterval(autoReadInterval);
                    autoReadInterval = null;
                }
            }, intervalTime);
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
        function startReading() {
            if (words.length === 0) return;
            
            isReading = true;
            isPaused = false;
            
            if (startTime === null) {
                startTime = Date.now();
            } else {
                startTime = Date.now() - pausedTime;
            }
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('stopBtn').disabled = false;
            
            startTimer();
            highlightCurrentWord();
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
        async function startRecording() {
            try {
                // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù…Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©
                audioStream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true,
                        sampleRate: 44100,
                        channelCount: 2
                    }
                });
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙØ¶Ù„ ØªÙ†Ø³ÙŠÙ‚ Ù…ØªØ§Ø­
                const options = {
                    mimeType: 'audio/webm;codecs=opus',
                    audioBitsPerSecond: 128000
                };
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
                if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                    options.mimeType = 'audio/webm';
                }
                if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                    options.mimeType = 'audio/mp4';
                }
                
                mediaRecorder = new MediaRecorder(audioStream, options);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const mimeType = mediaRecorder.mimeType || 'audio/webm';
                    const audioBlob = new Blob(audioChunks, { type: mimeType });
                    saveAudioRecording(audioBlob, mimeType);
                };
                
                // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø¹ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
                mediaRecorder.start(1000);
                isRecording = true;
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                document.getElementById('recordBtn').disabled = true;
                document.getElementById('stopRecordBtn').disabled = false;
                document.getElementById('recordBtn').classList.add('recording-pulse');
                document.getElementById('recordingStatus').innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ <span class="recording-indicator"></span>';
                
                // Ø¨Ø¯Ø¡ Ø¹Ø¯Ø§Ø¯ ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                startRecordingTimer();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', error);
                let errorMessage = 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†.';
                
                if (error.name === 'NotAllowedError') {
                    errorMessage = 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†. ØªØ£ÙƒØ¯ Ù…Ù† ØªÙˆØµÙŠÙ„ Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ø¨Ø¬Ù‡Ø§Ø²Ùƒ.';
                }
                
                alert(errorMessage);
            }
        }

        // Ø¨Ø¯Ø¡ Ø¹Ø¯Ø§Ø¯ ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        function startRecordingTimer() {
            recordingStartTime = Date.now();
            recordingTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                const timeDisplay = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                document.getElementById('recordingStatus').innerHTML = `
                    Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ${timeDisplay} <span class="recording-indicator"></span>
                `;
            }, 1000);
        }

        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                audioStream.getTracks().forEach(track => track.stop());
                isRecording = false;
                
                // Ø¥ÙŠÙ‚Ø§Ù Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                if (recordingTimer) {
                    clearInterval(recordingTimer);
                    recordingTimer = null;
                }
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                document.getElementById('recordBtn').disabled = false;
                document.getElementById('stopRecordBtn').disabled = true;
                document.getElementById('recordBtn').classList.remove('recording-pulse');
                document.getElementById('recordingStatus').innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
                
                setTimeout(() => {
                    document.getElementById('recordingStatus').textContent = 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ³Ø¬ÙŠÙ„';
                }, 3000);
            }
        }

        // Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
        function pauseReading() {
            isReading = false;
            isPaused = true;
            pausedTime = Date.now() - startTime;
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            
            clearInterval(timerInterval);
        }

        // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
        function stopReading() {
            isReading = false;
            isPaused = false;
            
            const endTime = Date.now();
            const totalTime = Math.floor((endTime - startTime) / 1000);
            const wordsPerMinute = Math.round((currentWordIndex / totalTime) * 60);
            
            // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©
            saveSession(totalTime, currentWordIndex, wordsPerMinute);
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('stopBtn').disabled = true;
            
            clearInterval(timerInterval);
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            showResults(totalTime, currentWordIndex, wordsPerMinute);
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„ Ø´ÙŠØ¡
        function resetAll() {
            resetReading();
            loadSelectedText();
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
        function resetReading() {
            isReading = false;
            isPaused = false;
            startTime = null;
            pausedTime = 0;
            currentWordIndex = 0;
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¢Ù„ÙŠØ©
            if (isAutoReading) {
                stopAutoRead();
            }
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('stopBtn').disabled = true;
            
            clearInterval(timerInterval);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ø±Ø¶
            document.getElementById('timerDisplay').textContent = '00:00';
            document.getElementById('wordsRead').textContent = '0';
            document.getElementById('readingSpeed').textContent = '0 Ùƒ/Ø¯';
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressText').textContent = '0%';
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ² Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª
            words.forEach((_, index) => {
                const wordElement = document.getElementById(`word-${index}`);
                if (wordElement) {
                    wordElement.classList.remove('word-highlight');
                }
            });
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
        function startTimer() {
            timerInterval = setInterval(() => {
                if (!isReading) return;
                
                const currentTime = Date.now();
                const elapsed = Math.floor((currentTime - startTime) / 1000);
                
                updateTimerDisplay(elapsed);
                updateStats(elapsed);
                updateProgress();
                
                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
                if (currentWordIndex < words.length - 1) {
                    currentWordIndex++;
                    highlightCurrentWord();
                } else {
                    stopReading();
                }
            }, 1000);
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¤Ù‚Øª
        function updateTimerDisplay(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const display = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            
            document.getElementById('timerDisplay').textContent = display;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©
            const circumference = 283;
            const progress = (seconds % 60) / 60;
            const offset = circumference - (progress * circumference);
            document.getElementById('timerCircle').style.strokeDashoffset = offset;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStats(elapsed) {
            document.getElementById('wordsRead').textContent = currentWordIndex;
            
            if (elapsed > 0) {
                const wordsPerMinute = Math.round((currentWordIndex / elapsed) * 60);
                document.getElementById('readingSpeed').textContent = wordsPerMinute + ' Ùƒ/Ø¯';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        function updateProgress() {
            const progress = (currentWordIndex / words.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = Math.round(progress) + '%';
        }

        // ØªÙ…ÙŠÙŠØ² Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function highlightCurrentWord() {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ² Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            if (currentWordIndex > 0) {
                const prevWord = document.getElementById(`word-${currentWordIndex - 1}`);
                if (prevWord) {
                    prevWord.classList.remove('word-highlight');
                }
            }
            
            // ØªÙ…ÙŠÙŠØ² Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const currentWord = document.getElementById(`word-${currentWordIndex}`);
            if (currentWord) {
                currentWord.classList.add('word-highlight');
                currentWord.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©
        function saveSession(duration, wordsRead, wpm) {
            const progress = Math.round((wordsRead / words.length) * 100);
            const session = {
                date: new Date().toLocaleDateString('ar-SA'),
                time: new Date().toLocaleTimeString('ar-SA'),
                text: texts[currentTextIndex].title,
                duration: duration,
                wordsRead: wordsRead,
                wpm: wpm,
                progress: progress
            };
            
            sessions.unshift(session);
            if (sessions.length > 10) sessions.pop(); // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 10 Ø¬Ù„Ø³Ø§Øª
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
            updateSpeedChart(wpm);
            updateProgressChart(progress);
            
            updateSessionHistory();
        }

        // Ø­ÙØ¸ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
        function saveAudioRecording(audioBlob, mimeType) {
            const audioUrl = URL.createObjectURL(audioBlob);
            const currentTime = Date.now();
            const recordingDuration = recordingStartTime ? Math.floor((currentTime - recordingStartTime) / 1000) : 0;
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„Ù…Ù„Ù Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ØµÙˆØª
            let fileExtension = 'webm';
            if (mimeType.includes('mp4')) fileExtension = 'mp4';
            else if (mimeType.includes('wav')) fileExtension = 'wav';
            else if (mimeType.includes('ogg')) fileExtension = 'ogg';
            
            const recording = {
                id: Date.now(),
                date: new Date().toLocaleDateString('ar-SA'),
                time: new Date().toLocaleTimeString('ar-SA'),
                text: texts[currentTextIndex].title,
                audioUrl: audioUrl,
                audioBlob: audioBlob,
                mimeType: mimeType,
                fileExtension: fileExtension,
                duration: recordingDuration,
                size: Math.round(audioBlob.size / 1024), // Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª
                wordsRead: currentWordIndex,
                wpm: recordingDuration > 0 ? Math.round((currentWordIndex / recordingDuration) * 60) : 0,
                quality: audioBlob.size > 100000 ? 'Ø¹Ø§Ù„ÙŠØ©' : audioBlob.size > 50000 ? 'Ù…ØªÙˆØ³Ø·Ø©' : 'Ù…Ù†Ø®ÙØ¶Ø©'
            };
            
            // Ø­ÙØ¸ ÙÙŠ IndexedDB Ù„Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¯Ø§Ø¦Ù…
            saveToIndexedDB(recording);
            
            // ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ù„Ù
            downloadRecording(audioUrl, recording.text, recording.date, fileExtension);
            
            // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
            if (!window.audioRecordings) window.audioRecordings = [];
            window.audioRecordings.unshift(recording);
            if (window.audioRecordings.length > 20) {
                const oldRecording = window.audioRecordings.pop();
                URL.revokeObjectURL(oldRecording.audioUrl);
            }
            
            updateAudioRecordings();
            
            // Ø¥Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ Ø§Ù„Ø­ÙØ¸
            showNotification('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ!', 'success');
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©
        function updateAudioRecordings() {
            const recordingsDiv = document.getElementById('audioRecordings');
            const recordings = window.audioRecordings || [];
            
            if (recordings.length === 0) {
                recordingsDiv.innerHTML = '<div class="text-center text-gray-500 py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¬ÙŠÙ„Ø§Øª ØµÙˆØªÙŠØ© Ø¨Ø¹Ø¯</div>';
                return;
            }
            
            recordingsDiv.innerHTML = recordings.map(recording => `
                <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-3 rounded-lg border border-blue-200">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-sm font-bold text-gray-800">${recording.text}</div>
                        <div class="text-xs text-gray-500">${recording.date}</div>
                    </div>
                    <div class="mb-3">
                        <audio controls class="w-full h-8" style="height: 32px;">
                            <source src="${recording.audioUrl}" type="audio/wav">
                            Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
                        </audio>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-xs mb-2">
                        <div><span class="text-gray-600">Ø§Ù„Ù…Ø¯Ø©:</span> <span class="font-bold">${Math.floor(recording.duration / 60)}:${(recording.duration % 60).toString().padStart(2, '0')}</span></div>
                        <div><span class="text-gray-600">Ø§Ù„Ø­Ø¬Ù…:</span> <span class="font-bold">${recording.size} Ùƒ.Ø¨</span></div>
                        <div><span class="text-gray-600">Ø§Ù„ÙƒÙ„Ù…Ø§Øª:</span> <span class="font-bold">${recording.wordsRead || 0}</span></div>
                        <div><span class="text-gray-600">Ø§Ù„Ø³Ø±Ø¹Ø©:</span> <span class="font-bold">${recording.wpm || 0} Ùƒ/Ø¯</span></div>
                        <div><span class="text-gray-600">Ø§Ù„Ø¬ÙˆØ¯Ø©:</span> <span class="font-bold">${recording.quality || 'Ù…ØªÙˆØ³Ø·Ø©'}</span></div>
                        <div><span class="text-gray-600">Ø§Ù„Ù†ÙˆØ¹:</span> <span class="font-bold">${recording.fileExtension?.toUpperCase() || 'WEBM'}</span></div>
                    </div>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="downloadRecording('${recording.audioUrl}', '${recording.text}', '${recording.date}', '${recording.fileExtension || 'webm'}')" class="btn-gradient text-white px-3 py-1 rounded text-xs">
                            ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                        </button>
                        <button onclick="deleteRecording(${recording.id})" class="btn-danger text-white px-3 py-1 rounded text-xs">
                            ğŸ—‘ï¸ Ø­Ø°Ù
                        </button>
                        <button onclick="shareRecording(${recording.id})" class="btn-success text-white px-3 py-1 rounded text-xs">
                            ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ©
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        function downloadRecording(audioUrl, textTitle, date, fileExtension = 'webm') {
            const link = document.createElement('a');
            link.href = audioUrl;
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ø®Ø§ØµØ©
            const cleanTitle = textTitle.replace(/[^\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF\w\s]/g, '');
            const cleanDate = date.replace(/[^\d-]/g, '-');
            const timestamp = new Date().toISOString().slice(11, 19).replace(/:/g, '-');
            
            link.download = `ØªØ³Ø¬ÙŠÙ„_Ù‚Ø±Ø§Ø¡Ø©_${cleanTitle}_${cleanDate}_${timestamp}.${fileExtension}`;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„ØµÙØ­Ø© ÙˆØªÙØ¹ÙŠÙ„Ù‡ Ø«Ù… Ø­Ø°ÙÙ‡
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù: ${link.download}`);
        }

        // Ø­Ø°Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        async function deleteRecording(recordingId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ØŸ')) {
                const recordings = window.audioRecordings || [];
                const recordingIndex = recordings.findIndex(r => r.id === recordingId);
                
                if (recordingIndex !== -1) {
                    // ØªØ­Ø±ÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                    URL.revokeObjectURL(recordings[recordingIndex].audioUrl);
                    recordings.splice(recordingIndex, 1);
                    
                    // Ø­Ø°Ù Ù…Ù† IndexedDB
                    try {
                        const db = await initIndexedDB();
                        const transaction = db.transaction(['recordings'], 'readwrite');
                        const store = transaction.objectStore('recordings');
                        await store.delete(recordingId);
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', error);
                    }
                    
                    updateAudioRecordings();
                }
            }
        }

        // Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        function shareRecording(recordingId) {
            const recording = window.audioRecordings.find(r => r.id === recordingId);
            if (!recording) return;
            
            if (navigator.share) {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Web Share API Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
                navigator.share({
                    title: `ØªØ³Ø¬ÙŠÙ„ Ù‚Ø±Ø§Ø¡Ø© - ${recording.text}`,
                    text: `ØªØ³Ø¬ÙŠÙ„ Ù‚Ø±Ø§Ø¡Ø© Ù„Ù†Øµ "${recording.text}" - Ø§Ù„Ù…Ø¯Ø©: ${Math.floor(recording.duration / 60)}:${(recording.duration % 60).toString().padStart(2, '0')} - Ø§Ù„Ø³Ø±Ø¹Ø©: ${recording.wpm} ÙƒÙ„Ù…Ø©/Ø¯Ù‚ÙŠÙ‚Ø©`,
                    files: [new File([recording.audioBlob], `ØªØ³Ø¬ÙŠÙ„_${recording.text}_${recording.date.replace(/\//g, '-')}.wav`, { type: 'audio/wav' })]
                }).catch(error => {
                    console.log('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:', error);
                    fallbackShare(recording);
                });
            } else {
                fallbackShare(recording);
            }
        }

        // Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø¯ÙŠÙ„Ø©
        function fallbackShare(recording) {
            const shareText = `ØªØ³Ø¬ÙŠÙ„ Ù‚Ø±Ø§Ø¡Ø© Ù„Ù†Øµ "${recording.text}"\nØ§Ù„Ù…Ø¯Ø©: ${Math.floor(recording.duration / 60)}:${(recording.duration % 60).toString().padStart(2, '0')}\nØ§Ù„Ø³Ø±Ø¹Ø©: ${recording.wpm} ÙƒÙ„Ù…Ø©/Ø¯Ù‚ÙŠÙ‚Ø©\nØ§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©: ${recording.wordsRead}`;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('ØªÙ… Ù†Ø³Ø® Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù„ØµÙ‚Ù‡Ø§ ÙˆÙ…Ø´Ø§Ø±ÙƒØªÙ‡Ø§.');
                });
            } else {
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ ÙÙŠ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù†Ø³Ø® Ø§Ù„ÙŠØ¯ÙˆÙŠ
                prompt('Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©:', shareText);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª
        function updateSessionHistory() {
            const historyDiv = document.getElementById('sessionHistory');
            
            if (sessions.length === 0) {
                historyDiv.innerHTML = '<div class="text-center text-gray-500 py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</div>';
                return;
            }
            
            historyDiv.innerHTML = sessions.map(session => `
                <div class="bg-gradient-to-r from-gray-50 to-gray-100 p-3 rounded-lg border border-gray-200">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-sm font-bold text-gray-800">${session.text}</div>
                        <div class="text-xs text-gray-500">${session.date}</div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                        <div><span class="text-gray-600">Ø§Ù„Ù…Ø¯Ø©:</span> <span class="font-bold">${Math.floor(session.duration / 60)}:${(session.duration % 60).toString().padStart(2, '0')}</span></div>
                        <div><span class="text-gray-600">Ø§Ù„Ø³Ø±Ø¹Ø©:</span> <span class="font-bold">${session.wpm} Ùƒ/Ø¯</span></div>
                        <div><span class="text-gray-600">Ø§Ù„ÙƒÙ„Ù…Ø§Øª:</span> <span class="font-bold">${session.wordsRead}</span></div>
                        <div><span class="text-gray-600">Ø§Ù„ØªÙ‚Ø¯Ù…:</span> <span class="font-bold">${session.progress}%</span></div>
                    </div>
                </div>
            `).join('');
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function showResults(duration, wordsRead, wpm) {
            const minutes = Math.floor(duration / 60);
            const seconds = duration % 60;
            const progress = Math.round((wordsRead / words.length) * 100);
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ø­ØªÙØ§Ù„
            document.querySelector('.timer-container').classList.add('celebration');
            setTimeout(() => {
                document.querySelector('.timer-container').classList.remove('celebration');
            }, 600);
            
            alert(`ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø¬Ù„Ø³Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©\n\nâ±ï¸ Ø§Ù„Ù…Ø¯Ø©: ${minutes}:${seconds.toString().padStart(2, '0')}\nğŸ“– Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©: ${wordsRead}\nğŸš€ Ø§Ù„Ø³Ø±Ø¹Ø©: ${wpm} ÙƒÙ„Ù…Ø©/Ø¯Ù‚ÙŠÙ‚Ø©\nğŸ“Š Ø§Ù„ØªÙ‚Ø¯Ù…: ${progress}%`);
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
        function initializeCharts() {
            // ØªÙ‡ÙŠØ¦Ø© Ù…Ø®Ø·Ø· Ø§Ù„Ø³Ø±Ø¹Ø©
            const speedCtx = document.getElementById('speedChart').getContext('2d');
            const savedSpeedData = JSON.parse(localStorage.getItem('speedChartData') || '{"labels":[],"data":[]}');
            speedChartData.labels = savedSpeedData.labels || [];
            speedChartData.datasets[0].data = savedSpeedData.data || [];
            
            speedChart = new Chart(speedCtx, {
                type: 'line',
                data: speedChartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                font: {
                                    family: 'Cairo, Tajawal, sans-serif',
                                    size: 12
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ÙƒÙ„Ù…Ø©/Ø¯Ù‚ÙŠÙ‚Ø©',
                                font: {
                                    family: 'Cairo, Tajawal, sans-serif',
                                    size: 12
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Ø§Ù„Ø¬Ù„Ø³Ø§Øª',
                                font: {
                                    family: 'Cairo, Tajawal, sans-serif',
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });

            // ØªÙ‡ÙŠØ¦Ø© Ù…Ø®Ø·Ø· Ø§Ù„ØªÙ‚Ø¯Ù…
            const progressCtx = document.getElementById('progressChart').getContext('2d');
            const savedProgressData = JSON.parse(localStorage.getItem('progressChartData') || '{"labels":[],"data":[]}');
            progressChartData.labels = savedProgressData.labels || [];
            progressChartData.datasets[0].data = savedProgressData.data || [];
            
            progressChart = new Chart(progressCtx, {
                type: 'bar',
                data: progressChartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                font: {
                                    family: 'Cairo, Tajawal, sans-serif',
                                    size: 12
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ‚Ø¯Ù… (%)',
                                font: {
                                    family: 'Cairo, Tajawal, sans-serif',
                                    size: 12
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Ø§Ù„Ø¬Ù„Ø³Ø§Øª',
                                font: {
                                    family: 'Cairo, Tajawal, sans-serif',
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ø®Ø·Ø· Ø§Ù„Ø³Ø±Ø¹Ø©
        function updateSpeedChart(wpm) {
            const sessionNumber = speedChartData.labels.length + 1;
            speedChartData.labels.push(`Ø¬Ù„Ø³Ø© ${sessionNumber}`);
            speedChartData.datasets[0].data.push(wpm);
            
            // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 15 Ø¬Ù„Ø³Ø© ÙÙ‚Ø·
            if (speedChartData.labels.length > 15) {
                speedChartData.labels.shift();
                speedChartData.datasets[0].data.shift();
            }
            
            speedChart.update();
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            localStorage.setItem('speedChartData', JSON.stringify({
                labels: speedChartData.labels,
                data: speedChartData.datasets[0].data
            }));
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ø®Ø·Ø· Ø§Ù„ØªÙ‚Ø¯Ù…
        function updateProgressChart(progress) {
            const sessionNumber = progressChartData.labels.length + 1;
            progressChartData.labels.push(`Ø¬Ù„Ø³Ø© ${sessionNumber}`);
            progressChartData.datasets[0].data.push(progress);
            
            // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 15 Ø¬Ù„Ø³Ø© ÙÙ‚Ø·
            if (progressChartData.labels.length > 15) {
                progressChartData.labels.shift();
                progressChartData.datasets[0].data.shift();
            }
            
            progressChart.update();
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            localStorage.setItem('progressChartData', JSON.stringify({
                labels: progressChartData.labels,
                data: progressChartData.datasets[0].data
            }));
        }

        // Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø·Ø· Ø§Ù„Ø³Ø±Ø¹Ø©
        function clearSpeedChartData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø·Ø· Ø§Ù„Ø³Ø±Ø¹Ø©ØŸ')) {
                speedChartData.labels = [];
                speedChartData.datasets[0].data = [];
                speedChart.update();
                localStorage.removeItem('speedChartData');
            }
        }

        // Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø·Ø· Ø§Ù„ØªÙ‚Ø¯Ù…
        function clearProgressChartData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø·Ø· Ø§Ù„ØªÙ‚Ø¯Ù…ØŸ')) {
                progressChartData.labels = [];
                progressChartData.datasets[0].data = [];
                progressChart.update();
                localStorage.removeItem('progressChartData');
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© IndexedDB
        function initIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('ReadingRecordings', 1);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('recordings')) {
                        const store = db.createObjectStore('recordings', { keyPath: 'id' });
                        store.createIndex('date', 'date', { unique: false });
                    }
                };
            });
        }

        // Ø­ÙØ¸ ÙÙŠ IndexedDB
        async function saveToIndexedDB(recording) {
            try {
                const db = await initIndexedDB();
                const transaction = db.transaction(['recordings'], 'readwrite');
                const store = transaction.objectStore('recordings');
                
                // ØªØ­ÙˆÙŠÙ„ audioBlob Ø¥Ù„Ù‰ ArrayBuffer Ù„Ù„Ø­ÙØ¸
                const arrayBuffer = await recording.audioBlob.arrayBuffer();
                const recordingToSave = {
                    ...recording,
                    audioData: arrayBuffer,
                    audioBlob: null, // Ù„Ø§ Ù†Ø­ÙØ¸ Ø§Ù„Ù€ blob Ù…Ø¨Ø§Ø´Ø±Ø©
                    audioUrl: null   // Ù„Ø§ Ù†Ø­ÙØ¸ Ø§Ù„Ù€ URL
                };
                
                await store.add(recordingToSave);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ù…Ù† IndexedDB
        async function loadFromIndexedDB() {
            try {
                const db = await initIndexedDB();
                const transaction = db.transaction(['recordings'], 'readonly');
                const store = transaction.objectStore('recordings');
                const request = store.getAll();
                
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => {
                        const recordings = request.result.map(recording => {
                            // ØªØ­ÙˆÙŠÙ„ ArrayBuffer Ø¥Ù„Ù‰ Blob
                            const audioBlob = new Blob([recording.audioData], { type: 'audio/wav' });
                            const audioUrl = URL.createObjectURL(audioBlob);
                            
                            return {
                                ...recording,
                                audioBlob: audioBlob,
                                audioUrl: audioUrl
                            };
                        });
                        resolve(recordings);
                    };
                    request.onerror = () => reject(request.error);
                });
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª:', error);
                return [];
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, type = 'info', duration = 4000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'error' ? 'bg-red-500' : 
                           type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';
            
            notification.className = `${bgColor} text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 max-w-sm`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="font-medium">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-3 text-white hover:text-gray-200">
                        âœ•
                    </button>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            }, duration);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        function loadVoices() {
            return new Promise((resolve) => {
                let voices = speechSynthesis.getVoices();
                
                if (voices.length > 0) {
                    resolve(voices);
                } else {
                    // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª
                    speechSynthesis.onvoiceschanged = () => {
                        voices = speechSynthesis.getVoices();
                        resolve(voices);
                    };
                    
                    // Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ø¶Ø§ÙÙŠ ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø¯Ø«
                    setTimeout(() => {
                        voices = speechSynthesis.getVoices();
                        resolve(voices);
                    }, 1000);
                }
            });
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        async function showAvailableVoices() {
            const voices = await loadVoices();
            availableVoices = voices;
            
            const arabicVoices = voices.filter(voice => 
                voice.lang.includes('ar') || 
                voice.name.includes('Arabic') ||
                voice.name.includes('Ø¹Ø±Ø¨ÙŠ')
            );
            
            console.log('Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©:', arabicVoices);
            console.log('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:', voices.length);
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙˆØ§Øª
            updateVoiceSelect(voices, arabicVoices);
            
            if (arabicVoices.length > 0) {
                showNotification(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${arabicVoices.length} ØµÙˆØª Ø¹Ø±Ø¨ÙŠ`, 'success', 3000);
                // Ø§Ø®ØªÙŠØ§Ø± Ø£ÙˆÙ„ ØµÙˆØª Ø¹Ø±Ø¨ÙŠ ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ
                selectedVoice = arabicVoices[0];
            } else {
                showNotification('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ØµÙˆØ§Øª Ø¹Ø±Ø¨ÙŠØ©ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ', 'warning', 4000);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ØµÙˆØ§Øª
        function updateVoiceSelect(allVoices, arabicVoices) {
            const voiceSelect = document.getElementById('voiceSelect');
            voiceSelect.innerHTML = '';
            
            // Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠ
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Ø§Ù„ØµÙˆØª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ';
            voiceSelect.appendChild(defaultOption);
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
            if (arabicVoices.length > 0) {
                const arabicGroup = document.createElement('optgroup');
                arabicGroup.label = 'Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
                
                arabicVoices.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.value = index + '_arabic';
                    option.textContent = `${voice.name} (${voice.lang})`;
                    if (index === 0) option.selected = true; // Ø§Ø®ØªÙŠØ§Ø± Ø£ÙˆÙ„ ØµÙˆØª Ø¹Ø±Ø¨ÙŠ
                    arabicGroup.appendChild(option);
                });
                
                voiceSelect.appendChild(arabicGroup);
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£ØµÙˆØ§Øª
            const otherVoices = allVoices.filter(voice => 
                !voice.lang.includes('ar') && 
                !voice.name.includes('Arabic') &&
                !voice.name.includes('Ø¹Ø±Ø¨ÙŠ')
            );
            
            if (otherVoices.length > 0) {
                const otherGroup = document.createElement('optgroup');
                otherGroup.label = 'Ø£ØµÙˆØ§Øª Ø£Ø®Ø±Ù‰';
                
                otherVoices.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.value = (index + arabicVoices.length) + '_other';
                    option.textContent = `${voice.name} (${voice.lang})`;
                    otherGroup.appendChild(option);
                });
                
                voiceSelect.appendChild(otherGroup);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø¯Ø¯
        function updateSelectedVoice() {
            const voiceSelect = document.getElementById('voiceSelect');
            const selectedValue = voiceSelect.value;
            
            if (!selectedValue) {
                selectedVoice = null;
                return;
            }
            
            const [indexStr, type] = selectedValue.split('_');
            const index = parseInt(indexStr);
            
            if (type === 'arabic') {
                const arabicVoices = availableVoices.filter(voice => 
                    voice.lang.includes('ar') || 
                    voice.name.includes('Arabic') ||
                    voice.name.includes('Ø¹Ø±Ø¨ÙŠ')
                );
                selectedVoice = arabicVoices[index];
            } else {
                const otherVoices = availableVoices.filter(voice => 
                    !voice.lang.includes('ar') && 
                    !voice.name.includes('Arabic') &&
                    !voice.name.includes('Ø¹Ø±Ø¨ÙŠ')
                );
                selectedVoice = otherVoices[index];
            }
            
            console.log('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙˆØª:', selectedVoice?.name);
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø¯Ø¯
        function testVoice() {
            if (isAutoReading) {
                showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¢Ù„ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                return;
            }
            
            const testText = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø¯Ø¯';
            const testUtterance = new SpeechSynthesisUtterance(testText);
            
            testUtterance.lang = 'ar-SA';
            testUtterance.rate = autoReadSpeed;
            testUtterance.pitch = 1.0;
            testUtterance.volume = 1.0;
            
            if (selectedVoice) {
                testUtterance.voice = selectedVoice;
            }
            
            testUtterance.onstart = () => {
                showNotification('ğŸµ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª...', 'info', 2000);
            };
            
            testUtterance.onend = () => {
                showNotification('âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª', 'success', 2000);
            };
            
            testUtterance.onerror = (event) => {
                showNotification('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª: ' + event.error, 'error');
            };
            
            speechSynthesis.speak(testUtterance);
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', async function() {
            loadSelectedText();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
            initializeCharts();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            window.audioRecordings = await loadFromIndexedDB();
            updateAudioRecordings();
            
            // ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
            await showAvailableVoices();
            
            // Ø¥Ø´Ø¹Ø§Ø± ØªØ±Ø­ÙŠØ¨ÙŠ
            setTimeout(() => {
                showNotification('ğŸ™ï¸ Ù…Ø±Ø­Ø¨Ø§Ù‹! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¢Ù„ÙŠØ© ÙˆØ§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ', 'info', 6000);
            }, 2000);
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            document.addEventListener('keydown', function(e) {
                if (e.code === 'Space') {
                    e.preventDefault();
                    if (!isReading && !isPaused) {
                        startReading();
                    } else if (isReading) {
                        pauseReading();
                    } else if (isPaused) {
                        startReading();
                    }
                } else if (e.code === 'Escape') {
                    stopReading();
                } else if (e.code === 'KeyR' && e.ctrlKey) {
                    e.preventDefault();
                    if (!isRecording) {
                        startRecording();
                    } else {
                        stopRecording();
                    }
                } else if (e.code === 'KeyA' && e.ctrlKey) {
                    e.preventDefault();
                    toggleAutoRead();
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'974d8a0f979be70c',t:'MTc1NjE1MDU5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
